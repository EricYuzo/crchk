#! /usr/bin/env sh

error() {
    echo "$PROGRAM: $@" 1>&2
    exit 1
}

check_dependencies() {
    `command -v crc32 > /dev/null`
    if [ $? -ne 0 ] ; then
        error "program crc32 missing."
    fi
}

verify() {
    name=$1
    crc_name=`echo "$name" | tr '[A-F]' '[a-f]' | sed 's/.*\[\([0-9a-f]\{8\}\)\].*/\1/'`
    crc_calc=`crc32 $1`
    if [ "$crc_name" = "$crc_calc" ] ; then
        status="ok"
    else
        status="corrupted"
    fi

    echo "$name    $crc_name    $crc_calc    $status"
}

main() {
    check_dependencies

    verify $1
}


PROGRAM=$(basename $0)

main "$1"
